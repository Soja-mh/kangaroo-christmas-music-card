(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();const y=[{title:"Puccini - Musettas Waltz",filename:"Puccini - La BoheÌ€me - Musettas Waltz.mp3"},{title:"Franz Liszt - Un Sospiro",filename:"Franz Liszt - Un Sospiro.mp3"},{title:"Franz Liszt - Liebestraum",filename:"Franz Liszt - Liebestraum - Love Dream.mp3"},{title:"Dark is the Night",filename:"Dark is the Night - Soviet WW2 Song.mp3"}],M={day:"bgm_day.mp3",night:"bgm_night.mp3"},P=[{name:"finn",states:[{image:"/images/finn-sword.png",songIndex:0},{image:"/images/finn-piano.png",songIndex:1}]},{name:"jake",states:[{image:"/images/jake-violin.png",songIndex:2},{image:"/images/jake-sandwich.png",songIndex:3}]}];let c=null,o=null,u=0,d=!1,L="day";const g=document.getElementById("current-song-info"),l=document.getElementById("play-pause-button"),E=document.getElementById("next-song-button"),p=document.getElementById("main-app");function f(s=L){if(d)return;const t=M[s];(!c||c.src.indexOf(t)===-1)&&(c&&c.pause(),c=new Audio(`/audio/${t}`),c.loop=!0),c.volume=1,c.play().catch(i=>console.log("BGM æ¢å¤å¤±è´¥ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’...",i))}function v(){c&&c.pause()}function I(){if(!o){h(u);return}d?(o.pause(),d=!1,l.textContent="â–¶",g.textContent=`Paused: ${y[u].title}`,f()):(v(),o.play().catch(s=>console.error("ç›®æ ‡æ­Œæ›²æ’­æ”¾å¤±è´¥:",s)),d=!0,l.textContent="â¸",g.textContent=`Playing: ${y[u].title}`)}function h(s){v(),u=s%y.length;const t=y[u];o&&(o.pause(),o=null);const a=`/audio/${t.filename}`;o=new Audio(a),o.loop=!1,o.volume=1,g.textContent=`Loading: ${t.title}`,l.textContent="â¸",o.addEventListener("loadeddata",()=>{console.log("éŸ³é¢‘åŠ è½½æˆåŠŸ:",a)}),o.addEventListener("error",e=>{console.error("ç›®æ ‡æ­Œæ›²åŠ è½½å¤±è´¥:",e),console.error("å°è¯•åŠ è½½çš„æ–‡ä»¶:",a),console.error("éŸ³é¢‘å…ƒç´ çŠ¶æ€:",o.readyState),d=!1,g.textContent=`Load Failed: ${t.title}`,l.textContent="â–¶"});const i=()=>{o.play().then(()=>{console.log("éŸ³é¢‘æ’­æ”¾æˆåŠŸ:",a),d=!0,l.textContent="â¸",g.textContent=`Playing: ${t.title}`}).catch(e=>{console.error("ç›®æ ‡æ­Œæ›²æ’­æ”¾å¤±è´¥:",e),console.error("å°è¯•æ’­æ”¾çš„æ–‡ä»¶:",a),d=!1,g.textContent=`Play Failed: ${t.title}`,l.textContent="â–¶"})};o.addEventListener("canplaythrough",i,{once:!0}),o.readyState>=2&&i(),o.onended=()=>{d=!1,f(),h(u+1)}}function k(){const s=document.getElementById("mode-toggle"),t=p.classList.contains("day");L=t?"night":"day",t?(p.classList.remove("day"),p.classList.add("night"),s.textContent="ðŸŒ™"):(p.classList.remove("night"),p.classList.add("day"),s.textContent="â˜€"),f(L),B()}function B(){const s=document.getElementById("npc-container");s.innerHTML="";const t=5,a=90,i=35,e=70;P.forEach(n=>{const r=Math.floor(Math.random()*n.states.length),x=n.states[r],C=Math.random()*(a-t)+t,S=Math.random()*(e-i)+i,m=document.createElement("img");m.className="npc",m.src=x.image,m.alt=`${n.name}-${r+1}`,m.dataset.songIndex=x.songIndex,m.style.left=`${C}vw`,m.style.top=`${S}vh`,s.appendChild(m)})}function N(){const s=document.getElementById("splash-screen"),t=document.getElementById("kangaroo"),a=document.getElementById("skip-button"),i=document.getElementById("mode-toggle");t.classList.add("animate-kangaroo");const e=()=>{s.style.opacity="0",setTimeout(()=>s.style.display="none",500),f("day"),B(),l.classList.remove("hidden"),E.classList.remove("hidden")};t.addEventListener("animationend",e,{once:!0}),a.addEventListener("click",e,{once:!0}),i.addEventListener("click",k),document.getElementById("npc-container").addEventListener("click",n=>{if(n.target.classList.contains("npc")){const r=parseInt(n.target.dataset.songIndex);isNaN(r)||(u===r&&o?I():h(r))}}),l.addEventListener("click",I),E.addEventListener("click",()=>{h(u+1)}),document.addEventListener("click",()=>{c&&c.paused&&f()},{once:!0})}document.addEventListener("DOMContentLoaded",N);
