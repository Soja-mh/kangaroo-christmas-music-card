(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();const y=[{title:"Puccini - Musettas Waltz",filename:"puccini-la-boheme-musettas-waltz.mp3"},{title:"Franz Liszt - Un Sospiro",filename:"franz-liszt-un-sospiro.mp3"},{title:"Franz Liszt - Liebestraum",filename:"franz-liszt-liebestraum-love-dream.mp3"},{title:"Dark is the Night",filename:"dark-is-the-night-soviet-ww2-song.mp3"}],k={day:"bgm_day.mp3",night:"bgm_night.mp3"},M=[{name:"finn",states:[{image:"./images/finn-sword.png",songIndex:0},{image:"./images/finn-piano.png",songIndex:1}]},{name:"jake",states:[{image:"./images/jake-violin.png",songIndex:2},{image:"./images/jake-sandwich.png",songIndex:3}]}];let c=null,o=null,u=0,l=!1,L="day";const g=document.getElementById("current-song-info"),d=document.getElementById("play-pause-button"),E=document.getElementById("next-song-button"),f=document.getElementById("main-app");function p(s=L){if(l)return;const t=k[s];(!c||c.src.indexOf(t)===-1)&&(c&&c.pause(),c=new Audio(`./audio/${t}`),c.loop=!0),c.volume=1,c.play().catch(i=>console.log("BGM æ¢å¤å¤±è´¥ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’...",i))}function v(){c&&c.pause()}function I(){if(!o){h(u);return}l?(o.pause(),l=!1,d.textContent="â–¶",g.textContent=`Paused: ${y[u].title}`,p()):(v(),o.play().catch(s=>console.error("ç›®æ ‡æ­Œæ›²æ’­æ”¾å¤±è´¥:",s)),l=!0,d.textContent="â¸",g.textContent=`Playing: ${y[u].title}`)}function h(s){v(),u=s%y.length;const t=y[u];o&&(o.pause(),o=null);const a=`./audio/${t.filename}`;o=new Audio(a),o.loop=!1,o.volume=1,g.textContent=`Loading: ${t.title}`,d.textContent="â¸",o.addEventListener("loadeddata",()=>{console.log("éŸ³é¢‘åŠ è½½æˆåŠŸ:",a)}),o.addEventListener("error",e=>{console.error("ç›®æ ‡æ­Œæ›²åŠ è½½å¤±è´¥:",e),console.error("å°è¯•åŠ è½½çš„æ–‡ä»¶:",a),console.error("éŸ³é¢‘å…ƒç´ çŠ¶æ€:",o.readyState),l=!1,g.textContent=`Load Failed: ${t.title}`,d.textContent="â–¶"});const i=()=>{o.play().then(()=>{console.log("éŸ³é¢‘æ’­æ”¾æˆåŠŸ:",a),l=!0,d.textContent="â¸",g.textContent=`Playing: ${t.title}`}).catch(e=>{console.error("ç›®æ ‡æ­Œæ›²æ’­æ”¾å¤±è´¥:",e),console.error("å°è¯•æ’­æ”¾çš„æ–‡ä»¶:",a),l=!1,g.textContent=`Play Failed: ${t.title}`,d.textContent="â–¶"})};o.addEventListener("canplaythrough",i,{once:!0}),o.readyState>=2&&i(),o.onended=()=>{l=!1,p(),h(u+1)}}function P(){const s=document.getElementById("mode-toggle"),t=f.classList.contains("day");L=t?"night":"day",t?(f.classList.remove("day"),f.classList.add("night"),s.textContent="ðŸŒ™"):(f.classList.remove("night"),f.classList.add("day"),s.textContent="â˜€"),p(L),B()}function B(){const s=document.getElementById("npc-container");s.innerHTML="";const t=5,a=90,i=35,e=70;M.forEach(n=>{const r=Math.floor(Math.random()*n.states.length),x=n.states[r],C=Math.random()*(a-t)+t,S=Math.random()*(e-i)+i,m=document.createElement("img");m.className="npc",m.src=x.image,m.alt=`${n.name}-${r+1}`,m.dataset.songIndex=x.songIndex,m.style.left=`${C}vw`,m.style.top=`${S}vh`,s.appendChild(m)})}function b(){const s=document.getElementById("splash-screen"),t=document.getElementById("kangaroo"),a=document.getElementById("skip-button"),i=document.getElementById("mode-toggle");t.classList.add("animate-kangaroo");const e=()=>{s.style.opacity="0",setTimeout(()=>s.style.display="none",500),p("day"),B(),d.classList.remove("hidden"),E.classList.remove("hidden")};t.addEventListener("animationend",e,{once:!0}),a.addEventListener("click",e,{once:!0}),i.addEventListener("click",P),document.getElementById("npc-container").addEventListener("click",n=>{if(n.target.classList.contains("npc")){const r=parseInt(n.target.dataset.songIndex);isNaN(r)||(u===r&&o?I():h(r))}}),d.addEventListener("click",I),E.addEventListener("click",()=>{h(u+1)}),document.addEventListener("click",()=>{c&&c.paused&&p()},{once:!0})}document.addEventListener("DOMContentLoaded",b);
